<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DREAMSTEAM - Detector de Plagio con IA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        body { background-color: #f0f2f5; color: #1f2937; }
        body.dark { background-color: #0f172a; color: #e2e8f0; }
        
        .screen {
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        body.dark .screen { background-color: #1e293b; }
        
        /* Ajuste para burbujas de chat */
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 20px;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        .user-bubble {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            border-bottom-right-radius: 4px;
        }
        .ai-bubble {
            background-color: #e5e7eb;
            color: #1f2937;
            border-bottom-left-radius: 4px;
        }
        body.dark .ai-bubble { background-color: #334155; color: #e2e8f0; }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 9999px;
            background-color: #1e293b;
            color: white;
            z-index: 100;
            opacity: 0;
            transition: all 0.3s ease;
        }
        .toast.show { opacity: 1; }
        .toast.error { background-color: #ef4444; }
        
        .similarity-high { background-color: #fef2f2; border-color: #fecaca; }
        .similarity-medium { background-color: #fffbeb; border-color: #fde68a; }
        .similarity-low { background-color: #f0fdf4; border-color: #bbf7d0; }
        body.dark .similarity-high { background-color: #450a0a; border-color: #7f1d1d; }
        body.dark .similarity-medium { background-color: #451a03; border-color: #78350f; }
        body.dark .similarity-low { background-color: #052e16; border-color: #166534; }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            transform: translateY(-1px);
        }
        
        input, textarea {
            transition: all 0.2s ease;
        }
        body.dark input, body.dark textarea {
            background-color: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        .document-card {
            transition: all 0.2s ease;
        }
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* Scroll personalizado */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        body.dark ::-webkit-scrollbar-thumb { background: #475569; }

        /* Animaciones */
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="min-h-screen">
    <div id="toast" class="toast"></div>

    <!-- PANTALLA DE BIENVENIDA -->
    <div id="welcome-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="screen w-full max-w-lg p-8 relative">
            <button onclick="toggleDarkMode()" class="absolute top-4 right-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                <svg id="theme-icon-welcome" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
            </button>
            
            <div class="text-center mb-8">
                <div class="w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-xl">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                </div>
                <h1 class="text-4xl font-bold gradient-text mb-2">DREAMSTEAM</h1>
                <p class="text-gray-500 dark:text-gray-400 text-lg">Detector de Plagio e IA</p>
            </div>

            <div class="space-y-4">
                <input 
                    type="text" 
                    id="username-input" 
                    placeholder="¬øCu√°l es tu nombre?"
                    class="w-full h-14 px-4 text-center text-lg border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                    onkeypress="if(event.key === 'Enter') handleLogin()"
                >
                <button onclick="handleLogin()" class="btn-gradient w-full h-14 rounded-xl text-lg shadow-lg">
                    Comenzar
                </button>
            </div>

            <div class="mt-8 grid grid-cols-3 gap-4 text-center text-sm">
                <div class="p-3 rounded-lg bg-blue-50 dark:bg-slate-700">
                    <svg class="w-6 h-6 mx-auto mb-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="text-gray-600 dark:text-gray-300">Detecta IA</span>
                </div>
                <div class="p-3 rounded-lg bg-purple-50 dark:bg-slate-700">
                    <svg class="w-6 h-6 mx-auto mb-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    <span class="text-gray-600 dark:text-gray-300">Compara Docs</span>
                </div>
                <div class="p-3 rounded-lg bg-green-50 dark:bg-slate-700">
                    <svg class="w-6 h-6 mx-auto mb-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="text-gray-600 dark:text-gray-300">Preciso</span>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA PRINCIPAL -->
    <div id="main-screen" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="screen p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold gradient-text">DREAMSTEAM</h1>
                            <p id="welcome-text" class="text-sm text-gray-500 dark:text-gray-400"></p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="toggleDarkMode()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
                            <svg id="theme-icon-main" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                            </svg>
                        </button>
                        <button onclick="handleLogout()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 text-red-500">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="openDirectChat()" class="screen p-6 text-left hover:shadow-xl transition-all group">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold mb-1">Chat con IA</h3>
                            <p class="text-gray-500 dark:text-gray-400">Pregunta sobre plagio y redacci√≥n</p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </button>

                <button onclick="openPlagiarismDetector()" class="screen p-6 text-left hover:shadow-xl transition-all group border-2 border-purple-200 dark:border-purple-900">
                    <div class="flex items-start gap-4">
                        <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="text-xl font-bold">Detector Avanzado</h3>
                                <span class="px-2 py-0.5 bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 text-xs font-semibold rounded-full">PRINCIPAL</span>
                            </div>
                            <p class="text-gray-500 dark:text-gray-400">Analiza IA y compara documentos</p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </button>
            </div>

            <div class="screen p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold">Documentos Guardados (Base de Datos)</h2>
                    <button onclick="openUploadModal()" class="btn-gradient px-4 py-2 rounded-lg flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Subir Documento
                    </button>
                </div>
                
                <div id="documents-list" class="space-y-3">
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <p>No hay documentos guardados</p>
                        <p class="text-sm mt-1">Sube documentos para que el sistema los compare</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA DE CHAT -->
    <div id="chat-screen" class="fixed inset-0 flex flex-col bg-[#f0f2f5] dark:bg-[#0f172a] z-50 hidden">
        <div class="flex-1 w-full max-w-4xl mx-auto flex flex-col h-full bg-white dark:bg-[#1e293b] shadow-xl md:rounded-2xl md:my-4 md:h-[calc(100vh-2rem)] overflow-hidden">
            
            <div class="p-4 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between bg-white dark:bg-[#1e293b] z-10">
                <div class="flex items-center gap-3">
                    <button onclick="goToMain()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div class="flex items-center gap-2">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold" id="chat-title">Asistente IA</h3>
                            <p class="text-xs text-green-500 font-medium">En l√≠nea</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="clearChat()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700" title="Limpiar chat">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-slate-800/50">
                </div>

            <div id="image-preview-container" class="hidden px-4 pt-2 bg-white dark:bg-[#1e293b] border-t border-gray-100 dark:border-slate-700">
                <div class="inline-flex items-start gap-2 p-2 rounded-lg bg-gray-100 dark:bg-slate-700">
                    <img id="image-preview" class="h-20 rounded" src="" alt="Preview">
                    <button onclick="removeImage()" class="p-1 rounded-full bg-red-500 text-white hover:bg-red-600">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="p-4 bg-white dark:bg-[#1e293b] border-t border-gray-200 dark:border-slate-700">
                <div class="flex items-end gap-2">
                    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleImageUpload(event)">
                    <button onclick="document.getElementById('file-input').click()" class="p-3 rounded-xl bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </button>
                    <button id="mic-btn" onclick="toggleVoice()" class="p-3 rounded-xl bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                    <input 
                        type="text" 
                        id="chat-input" 
                        placeholder="Escribe tu mensaje..."
                        class="flex-1 h-12 px-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl focus:border-blue-500 focus:outline-none bg-transparent"
                        onkeypress="if(event.key === 'Enter') sendMessage()"
                        autocomplete="off"
                    >
                    <button onclick="sendMessage()" class="btn-gradient p-3 rounded-xl shadow-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PANTALLA DETECTOR DE PLAGIO -->
    <div id="plagiarism-screen" class="min-h-screen p-4 md:p-6 hidden">
        <div class="max-w-6xl mx-auto">
            <div class="screen p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <button onclick="goToMain()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold">Detector de Plagio e IA</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Analiza similitud y autor√≠a IA</p>
                        </div>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
                        <svg id="theme-icon-plagiarism" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="screen p-6">
                    <h3 class="font-bold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Texto a Analizar
                    </h3>
                    <textarea 
                        id="plagiarism-text" 
                        placeholder="Pega aqu√≠ el texto que quieres analizar..."
                        class="w-full h-64 p-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl resize-none focus:border-purple-500 focus:outline-none"
                    ></textarea>
                    <div class="flex items-center justify-between mt-4">
                        <span id="word-count" class="text-sm text-gray-500">0 palabras</span>
                        <div class="flex gap-2">
                            <button onclick="clearPlagiarismText()" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600">
                                Limpiar
                            </button>
                            <button onclick="analyzePlagiarism()" class="btn-gradient px-6 py-2 rounded-lg flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                                Analizar Todo
                            </button>
                        </div>
                    </div>
                </div>

                <div class="screen p-6">
                    <h3 class="font-bold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Resultados del An√°lisis
                    </h3>
                    <div id="plagiarism-results" class="space-y-4">
                        <div class="text-center py-12 text-gray-400">
                            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            <p>Ingresa un texto para analizar</p>
                            <p class="text-sm mt-1">Detectar√° similitud con documentos e IA</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="screen p-6 mt-6">
                <h3 class="font-bold mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Comparar con Documentos Guardados
                </h3>
                <div id="compare-documents-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="text-center py-8 text-gray-400 col-span-full">
                        <p>No hay documentos para comparar</p>
                        <button onclick="openUploadModal()" class="mt-2 text-blue-500 hover:underline">Subir documentos</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE SUBIDA -->
    <div id="upload-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="screen w-full max-w-md mx-4 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold">Subir Documento</h3>
                <button onclick="closeUploadModal()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">T√≠tulo del documento</label>
                    <input type="text" id="doc-title" placeholder="Ej: Ensayo de historia" class="w-full h-12 px-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Autor / Estudiante</label>
                    <input type="text" id="doc-author" placeholder="Nombre del autor" class="w-full h-12 px-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Grupo / Clase</label>
                    <input type="text" id="doc-group" placeholder="Ej: 3¬∞ A Historia" class="w-full h-12 px-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Contenido del documento</label>
                    <textarea id="doc-content" placeholder="Pega aqu√≠ el contenido del documento..." class="w-full h-32 p-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl resize-none focus:border-blue-500 focus:outline-none"></textarea>
                </div>
                <button onclick="saveDocument()" class="btn-gradient w-full h-12 rounded-xl">
                    Guardar Documento
                </button>
            </div>
        </div>
    </div>

    <!-- OVERLAY DE CARGA -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="screen p-8 text-center">
            <div class="w-16 h-16 mx-auto mb-4 border-4 border-purple-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-lg font-medium" id="loading-text">Analizando...</p>
        </div>
    </div>

    <script>
        // ==========================================================
        // CONFIGURACI√ìN (Aseg√∫rate que esta Key tenga permisos para localhost)
        // ==========================================================
        const CONFIG = {
            apiKey: 'AIzaSyCsD-oRxrNXHFCyXjiH05_3N17aytJzWoU', 
            model: 'gemini-1.5-flash',
            apiUrl: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent'
        };

        // Estado Global
        let userName = '';
        let darkMode = false;
        let documents = [];
        let chatMessages = [];
        let currentMode = 'general';
        let uploadedImage = null;
        let recognition = null;
        let isListening = false;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            const savedName = localStorage.getItem('dreamsteam_username');
            const savedDarkMode = localStorage.getItem('dreamsteam_darkmode') === 'true';
            const savedDocs = localStorage.getItem('dreamsteam_documents');
            
            if (savedDocs) {
                try {
                    documents = JSON.parse(savedDocs);
                } catch(e) { documents = []; }
            }
            
            darkMode = savedDarkMode;
            if (darkMode) document.body.classList.add('dark');
            updateThemeIcons();
            
            if (savedName) {
                userName = savedName;
                showScreen('main');
                document.getElementById('welcome-text').textContent = 'Hola, ' + userName + ' üëã';
                renderDocuments();
            }

            // Inicializar reconocimiento de voz
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'es-ES';
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chat-input').value += transcript;
                    stopListening();
                };
                
                recognition.onerror = () => stopListening();
                recognition.onend = () => stopListening();
            }

            // Listener de contador de palabras
            document.getElementById('plagiarism-text').addEventListener('input', updateWordCount);
        });

        // Navegaci√≥n
        function showScreen(screen) {
            document.querySelectorAll('[id$="-screen"]').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(screen + '-screen');
            if(target) target.classList.remove('hidden');
        }

        function goToMain() {
            showScreen('main');
            renderDocuments();
        }

        // Auth Mockup
        function handleLogin() {
            const input = document.getElementById('username-input').value.trim();
            if (input) {
                userName = input;
                localStorage.setItem('dreamsteam_username', userName);
                document.getElementById('welcome-text').textContent = 'Hola, ' + userName + ' üëã';
                showScreen('main');
                showToast('¬°Bienvenido, ' + userName + '!');
            }
        }

        function handleLogout() {
            localStorage.removeItem('dreamsteam_username');
            userName = '';
            chatMessages = [];
            showScreen('welcome');
        }

        // Dark Mode
        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark', darkMode);
            localStorage.setItem('dreamsteam_darkmode', darkMode);
            updateThemeIcons();
        }

        function updateThemeIcons() {
            const sunPath = 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z';
            const moonPath = 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z';
            const path = darkMode ? sunPath : moonPath;
            
            ['welcome', 'main', 'plagiarism'].forEach(id => {
                const icon = document.getElementById('theme-icon-' + id);
                if (icon) icon.querySelector('path').setAttribute('d', path);
            });
        }

        // Toast Notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.remove('error');
            if(isError) toast.classList.add('error');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        // Chat Logic
        function openDirectChat() {
            currentMode = 'general';
            document.getElementById('chat-title').textContent = 'Asistente IA';
            if (chatMessages.length === 0) {
                chatMessages = [{
                    role: 'ai',
                    content: '¬°Hola ' + userName + '! üëã Soy tu asistente de DREAMSTEAM. Puedo ayudarte a:\n\n‚Ä¢ **Analizar textos** para ver si fueron hechos por IA.\n‚Ä¢ **Comparar documentos** para ver si son copias.\n‚Ä¢ **Mejorar tu redacci√≥n**.\n\n¬øQu√© necesitas hoy?'
                }];
            }
            renderChat();
            showScreen('chat');
        }

        function openPlagiarismDetector() {
            showScreen('plagiarism');
            renderCompareDocuments();
        }

        function renderChat() {
            const container = document.getElementById('chat-messages');
            container.innerHTML = chatMessages.map(msg => {
                const bubbleClass = msg.role === 'user' ? 'user-bubble ml-auto' : 'ai-bubble mr-auto';
                let content = msg.content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>');
                
                let imageHtml = '';
                if (msg.image) {
                    imageHtml = '<img src="' + msg.image + '" class="max-w-full rounded-lg mb-2" alt="Imagen">';
                }
                
                return '<div class="chat-bubble ' + bubbleClass + '">' + imageHtml + content + '</div>';
            }).join('');
            
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message && !uploadedImage) return;
            
            const userMsg = { role: 'user', content: message };
            if (uploadedImage) {
                userMsg.image = uploadedImage;
            }
            chatMessages.push(userMsg);
            renderChat();
            input.value = '';
            
            // Loading state
            const loadingId = 'loading-' + Date.now();
            chatMessages.push({ role: 'ai', content: '...', id: loadingId });
            renderChat();
            
            try {
                const systemPrompt = 'Eres DREAMSTEAM Assistant, un experto en integridad acad√©mica. Ayuda a detectar si un texto fue escrito por una IA o si es plagio. Responde en espa√±ol de forma √∫til y directa.';
                
                const response = await callGemini(systemPrompt + '\n\nUsuario: ' + message);
                
                chatMessages = chatMessages.filter(msg => msg.id !== loadingId);
                chatMessages.push({ role: 'ai', content: response });
                renderChat();
            } catch (error) {
                chatMessages = chatMessages.filter(msg => msg.id !== loadingId);
                chatMessages.push({ role: 'ai', content: '‚ùå ' + error.message });
                renderChat();
                showToast(error.message, true);
            }
            
            removeImage();
        }

        function clearChat() {
            chatMessages = [{ role: 'ai', content: 'Chat limpiado. ¬øEn qu√© puedo ayudarte ahora?' }];
            renderChat();
            showToast('Chat limpiado');
        }

        // Imagenes
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImage = e.target.result;
                    document.getElementById('image-preview').src = uploadedImage;
                    document.getElementById('image-preview-container').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage() {
            uploadedImage = null;
            document.getElementById('image-preview-container').classList.add('hidden');
            document.getElementById('file-input').value = '';
        }

        // Voz
        function toggleVoice() {
            if (!recognition) {
                showToast('Tu navegador no soporta entrada de voz.', true);
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
                isListening = true;
                document.getElementById('mic-btn').classList.add('text-red-500');
            }
        }

        function stopListening() {
            isListening = false;
            document.getElementById('mic-btn').classList.remove('text-red-500');
        }

        // L√≥gica de Plagio
        function updateWordCount() {
            const text = document.getElementById('plagiarism-text').value;
            const words = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            document.getElementById('word-count').textContent = words + ' palabras';
        }

        function clearPlagiarismText() {
            document.getElementById('plagiarism-text').value = '';
            updateWordCount();
        }

        async function analyzePlagiarism() {
            const text = document.getElementById('plagiarism-text').value.trim();
            if (!text) {
                showToast('Ingresa un texto para analizar', true);
                return;
            }

            showLoading('Analizando similitudes y patrones de IA...');

            try {
                // 1. Local Comparison
                let comparisonResults = [];
                if (documents.length > 0) {
                    for (const doc of documents) {
                        const similarity = calculateSimilarity(text, doc.content);
                        if (similarity > 10) {
                            comparisonResults.push({
                                title: doc.title,
                                author: doc.author,
                                similarity: similarity,
                                matchingPhrases: findMatchingPhrases(text, doc.content)
                            });
                        }
                    }
                }

                // 2. AI Analysis
                const analysisPrompt = `
                Act√∫a como un detector de plagio y detector de IA avanzado. Analiza el siguiente texto:
                "${text.substring(0, 3000)}"
                
                Tu tarea es devolver un reporte con:
                1. Probabilidad de que sea generado por IA (0-100%) y por qu√©.
                2. Calidad de la redacci√≥n.
                3. Si detectas parafraseo inusual.
                
                Usa <b> para negritas. No uses Markdown, solo texto plano con tags HTML b√°sicos.
                `;

                const aiAnalysis = await callGemini(analysisPrompt);

                hideLoading();
                renderPlagiarismResults(comparisonResults, aiAnalysis, text.split(/\s+/).length);

            } catch (error) {
                hideLoading();
                console.error(error);
                showToast('Error: ' + error.message, true);
            }
        }

        function calculateSimilarity(text1, text2) {
            const words1 = text1.toLowerCase().split(/\s+/);
            const words2 = text2.toLowerCase().split(/\s+/);
            const ngrams1 = [];
            const ngrams2 = [];
            
            for (let i = 0; i < words1.length - 2; i++) {
                ngrams1.push(words1.slice(i, i + 3).join(' '));
            }
            for (let i = 0; i < words2.length - 2; i++) {
                ngrams2.push(words2.slice(i, i + 3).join(' '));
            }
            
            if (ngrams1.length === 0) return 0;
            const matches = ngrams1.filter(ng => ngrams2.includes(ng)).length;
            return Math.min((matches / ngrams1.length) * 100, 100);
        }

        function findMatchingPhrases(text1, text2) {
            const sentences1 = text1.split(/[.!?]+/).filter(s => s.trim().length > 20);
            const sentences2 = text2.split(/[.!?]+/).filter(s => s.trim().length > 20);
            
            const matches = [];
            for (const s1 of sentences1) {
                for (const s2 of sentences2) {
                    if (calculateSimilarity(s1, s2) > 60) {
                        matches.push(s1.trim().substring(0, 80) + '...');
                        if (matches.length >= 3) break;
                    }
                }
            }
            return matches;
        }

        function renderPlagiarismResults(comparisons, aiAnalysis, wordCount) {
            const container = document.getElementById('plagiarism-results');
            let html = '';
            
            // Local Results
            if (comparisons.length > 0) {
                html += '<div class="mb-6">';
                html += '<h4 class="font-bold text-lg mb-2 text-red-600">‚ö†Ô∏è Similitud con Documentos Internos</h4>';
                comparisons.sort((a, b) => b.similarity - a.similarity);
                
                for (const comp of comparisons) {
                    const compClass = comp.similarity >= 70 ? 'similarity-high' : 'similarity-medium';
                    html += `<div class="p-4 rounded-xl border-2 ${compClass} mb-3">`;
                    html += `<div class="flex justify-between items-center">`;
                    html += `<div><h5 class="font-bold">${comp.title}</h5><p class="text-sm">Autor: ${comp.author}</p></div>`;
                    html += `<span class="text-xl font-bold text-red-600">${comp.similarity.toFixed(1)}% Igual</span>`;
                    html += `</div>`;
                    if (comp.matchingPhrases.length > 0) {
                         html += `<div class="mt-2 text-xs text-gray-600 italic border-t border-gray-300 pt-1">Coincidencia: "${comp.matchingPhrases[0]}"</div>`;
                    }
                    html += `</div>`;
                }
                html += '</div>';
            } else {
                html += '<div class="p-4 mb-4 bg-green-50 border border-green-200 rounded-xl text-green-700 font-medium">‚úÖ No se encontraron coincidencias internas.</div>';
            }

            // AI Analysis
            html += '<div class="p-4 rounded-xl bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 shadow-sm">';
            html += '<h4 class="font-bold mb-3 flex items-center gap-2 text-purple-700 dark:text-purple-300">';
            html += '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>';
            html += 'An√°lisis de Inteligencia Artificial';
            html += '</h4>';
            html += '<div class="prose prose-sm dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">';
            html += aiAnalysis.replace(/\n/g, '<br>');
            html += '</div>';
            html += '</div>';

            container.innerHTML = html;
        }

        // Gestion de Documentos
        function renderDocuments() {
            const container = document.getElementById('documents-list');
            if (documents.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-400"><p>No hay documentos guardados</p></div>';
                return;
            }
            container.innerHTML = documents.map((doc, index) => {
                const wordCount = doc.content.split(/\s+/).length;
                return `<div class="document-card flex items-center justify-between p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-gray-200 dark:border-slate-600 mb-2">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center font-bold">DOC</div>
                        <div>
                            <h4 class="font-semibold">${doc.title}</h4>
                            <p class="text-xs text-gray-500">${doc.author} ‚Ä¢ ${wordCount} palabras</p>
                        </div>
                    </div>
                    <button onclick="deleteDocument(${index})" class="text-red-400 hover:text-red-600">Eliminar</button>
                    </div>`;
            }).join('');
        }

        function renderCompareDocuments() {
            const container = document.getElementById('compare-documents-list');
            if (documents.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-400">Sube documentos primero.</div>';
                return;
            }
            container.innerHTML = documents.map((doc, index) => {
                return `<div class="p-4 rounded-xl border hover:border-blue-500 cursor-pointer bg-white dark:bg-slate-800" onclick="compareWithDocument(${index})">
                    <h4 class="font-bold text-sm truncate">${doc.title}</h4>
                    <p class="text-xs text-gray-500">${doc.author}</p>
                </div>`;
            }).join('');
        }

        function compareWithDocument(index) {
            const doc = documents[index];
            document.getElementById('plagiarism-text').value = doc.content;
            updateWordCount();
            showToast('Texto cargado para an√°lisis');
        }

        function openUploadModal() { document.getElementById('upload-modal').classList.remove('hidden'); }
        function closeUploadModal() { document.getElementById('upload-modal').classList.add('hidden'); }

        function saveDocument() {
            const title = document.getElementById('doc-title').value.trim();
            const author = document.getElementById('doc-author').value.trim() || 'An√≥nimo';
            const group = document.getElementById('doc-group').value.trim() || 'Sin grupo';
            const content = document.getElementById('doc-content').value.trim();

            if (!title || !content) {
                showToast('Completa el t√≠tulo y contenido', true);
                return;
            }
            documents.push({ title, author, group, content, date: new Date().toISOString() });
            localStorage.setItem('dreamsteam_documents', JSON.stringify(documents));
            closeUploadModal();
            renderDocuments();
            showToast('Documento guardado');
        }

        function deleteDocument(index) {
            if (confirm('¬øEliminar este documento?')) {
                documents.splice(index, 1);
                localStorage.setItem('dreamsteam_documents', JSON.stringify(documents));
                renderDocuments();
            }
        }

        function showLoading(text) {
            document.getElementById('loading-text').textContent = text || 'Cargando...';
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        // ==========================================================
        // LLAMADA A LA API (Con Manejo de Errores Mejorado)
        // ==========================================================
        async function callGemini(prompt) {
            // Se usa la URL y KEY correctas del objeto CONFIG
            const url = CONFIG.apiUrl + '?key=' + CONFIG.apiKey;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2048
                        }
                    })
                });

                if (!response.ok) {
                    // Intento de leer el error exacto de Google
                    const errorBody = await response.json().catch(() => ({}));
                    console.error("Detalle del Error API:", errorBody);

                    let msg = 'Error desconocido en la API (' + response.status + ')';
                    if (response.status === 403) msg = '‚õî BLOQUEADO (403): Tu API Key est√° restringida y no permite este sitio web. Revisa Google Cloud Console.';
                    if (response.status === 400) msg = '‚ö†Ô∏è ERROR 400: Petici√≥n inv√°lida a la IA.';
                    
                    throw new Error(msg);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    return data.candidates[0].content.parts[0].text;
                }
                
                throw new Error('La IA no devolvi√≥ texto v√°lido.');
            } catch (error) {
                // Re-lanzar el error para que la UI lo muestre
                throw error; 
            }
        }
    </script>
</body>
</html>
